---
title: "Project _DS_5110_SP_2023_T_Goodwin"
author: "Taylor (Tay) Goodwin"
date: "2023-04-10"
output: pdf_document
---


# References:

https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5636241/

https://genus.springeropen.com/articles/10.1186/s41118-018-0042-x

https://www.cdc.gov/diabetes/managing/diabetes-kidney-disease.html#:~:text=Both%20type%201%20and%20type%202%20diabetes%20can%20cause%20kidney%20disease.&text=Kidney%20diseases%20are%20the%209th,begin%20treatment%20for%20kidney%20failure

https://www.scirp.org/journal/paperinformation.aspx?paperid=96881 
 ---- this second link is closer to the approach we are taking.
Quote: "mortality is being influenced by predictive factors including the income, educational advancement, medical improvement and discovery, sex, geographical location, technological advancement and political stability. Our objective in this paper is to fit multiple regression model to gain insight into how these various predictive variables relate to mortality."



```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(Metrics)
library(modelr)
library("RSQLite")
library(tidyr)
library(viridis)
library(maps)
library(ModelMetrics)
library(tidyr)
library(dplyr)
library(panelr)
library(plm)
library(readxl)
library(ggplot2)
library(tidyverse)
library(readr)
library(ggpubr)
library(naniar)
library(reshape2)
library(DBI)
library(RSQLite)
library(reshape2)
library(extrafont)
library(stringr)
library(showtext)
```

```{r data rename and var names}

health_data <- health.10p
economic <- econ.10p_pivot
var_names <- c(colnames(economic))
print(var_names)

health_2019 <- health_data %>%
  select(Cause, Data, Location, Year, Region) %>%
  filter(Cause == "Diabetes and kidney diseases, Deaths", Year == "2019", Region != "Other" ) %>%
    arrange(Location) %>%
  arrange(Year)

econ_2019 <- economic %>%
  filter(Year == "2019", Region != "Other")

df_2019 <- cbind(econ_2019, health_2019[, c(1:2)])


```

# Subsetting and Organizing Data
```{r subsetting and arranging source datasets}

cardio_deaths <- health_data %>%
  select(Location, Year, Data, Cause) %>%
  filter(Cause == "Cardiovascular diseases, Deaths", Year != 2019) %>%
  arrange(Location) %>%
  arrange(Year)

diabetes_kidn_deaths <- health_data %>%
  select(Location, Year, Data, Cause) %>%
  filter(Cause == "Diabetes and kidney diseases, Deaths", Year != 2019) %>%
  arrange(Location) %>%
  arrange(Year)

cardio_deaths$Cardio_Deaths <- cardio_deaths$Data
diabetes_kidn_deaths$Diabetes_Kidn_Deaths <- diabetes_kidn_deaths$Data



cardio_prev <- health_data %>%
  select(Location, Year, Data, Cause) %>%
  filter(Cause == "Cardiovascular diseases, Prevalence", Year != 2019) %>%
  arrange(Location) %>%
  arrange(Year)

diabetes_kidn_prev <- health_data %>%
  select(Location, Year, Data, Cause) %>%
  filter(Cause == "Diabetes and kidney diseases, Prevalence", Year != 2019) %>%
  arrange(Location) %>%
  arrange(Year)

cardio_prev$Cardio_Prev <- cardio_prev$Data
diabetes_kidn_prev$Diabetes_Kidn_Prev <- diabetes_kidn_prev$Data



cardio_incid <- health_data %>%
  select(Location, Year, Data, Cause) %>%
  filter(Cause == "Cardiovascular diseases, Incidence", Year != 2019) %>%
  arrange(Location) %>%
  arrange(Year)

diabetes_kidn_incid <- health_data %>%
  select(Location, Year, Data, Cause) %>%
  filter(Cause == "Diabetes and kidney diseases, Incidence", Year != 2019) %>%
  arrange(Location) %>%
  arrange(Year)

cardio_incid$Cardio_Incid <- cardio_incid$Data
diabetes_kidn_incid$Diabetes_Kidn_Incid <- diabetes_kidn_incid$Data



econ_test_data <- economic %>%
  select(colnames(economic)) %>%
  filter(Year != 2019)

```

# Full Dataset
```{r combining and filtering to make full dataset}

deaths <-cbind(cardio_deaths[, c(1:2,5)], Diabetes_Kidn_Deaths = diabetes_kidn_deaths$Diabetes_Kidn_Deaths, Cardio_Prev = cardio_prev$Cardio_Prev, Diabetes_Kidn_Prev = diabetes_kidn_prev$Diabetes_Kidn_Prev, Cardio_Incid = cardio_incid$Cardio_Incid, Diabetes_Kidn_Incid = diabetes_kidn_incid$Diabetes_Kidn_Incid)

data <- cbind(deaths, econ_test_data)
df <- as.data.frame(data[,c(1:8,11:length(colnames(data)))])
  
df <- df[df$Region != "Other",]
df <- df[df$Year != "2019",]

```

# Global Map of Diabetes and Kidney Disease Death Rates for the Year 2000 
Shows data for all available countries (204 of them)
```{r diabetes deaths map 2000}

diabetes_all_2000 <- health.full %>%
  select(Location, Year, Data, Cause) %>%
  filter(Cause == "Diabetes and kidney diseases, Deaths", Year == 2000) %>%
  arrange(Location) %>%
  arrange(Year)

world_map <- map_data("world")

diabetes.rate <- diabetes_all_2000 %>% 
  select(Location, Data) %>%
  rename(region = Location) %>%
  mutate(
    region = case_when(
      region == "United States" ~ "USA", 
      region == "United Kingdom" ~ "UK",
      region == "Russian Federation" ~ "Russia",
      region == "Lao PDR" ~ "Laos",
      region == "Congo" ~ "Democratic Republic of the Congo",
      region == "Czechia" ~ "Czech Republic",
      TRUE ~ region
    )
  )

diabetes.rate.map <- left_join(diabetes.rate, world_map, by = "region")

ggplot(diabetes.rate.map, aes(long, lat, group = group)) +
  geom_polygon(aes(fill = Data)) +
  scale_fill_viridis() + 
  labs(title = "Deaths from Diabetes and Kidney Diseases by Nation",
       subtitle = "Rates measured for a subset of 204 nations in the dataset")

```

# Scatter plots for Single Linear Regression Models
```{r exploratory analysis - diabetes death rates for all years}

# Diabetes Death Rates and Diabetes Prevalence
ggplot(data = df, aes(x = Diabetes_Kidn_Incid, color = as.factor(IncomeLevel), y = Diabetes_Kidn_Deaths)) + 
  geom_point() + 
  layer(geom="line",
        stat="smooth",
        position="identity", 
        params=list(method="auto", se=TRUE)) +
  labs(title = "Diabetes and Kidney Disease Incidence Rates and Death Rates",
       subtitle = "Diabetes and Kidney Disease Incidence",
       x = "x", y = "National Diatbetes Death Rate") + 
  facet_wrap(~ Year) +
  theme_minimal()

# Diabetes Death Rates and People using at least basic drinking water services
# People using basic drinking services serves as proxy for level of human public health services available in a nation, basic access would be relevant to someone's health.
ggplot(data = df, aes(x = `People using at least basic drinking water services (% of population)`, color = as.factor(IncomeLevel), y = Diabetes_Kidn_Deaths)) + geom_point() + layer(geom="line",
        stat="smooth",
        position="identity", 
        params=list(method="auto", se=TRUE)) +
  labs(title = "Drinking Water Services as a Proxy for Key National Public Health Services",
       subtitle = "People using at least basic drinking water services (% of population)",
       x = "Percent of Population with Basic Drinking Water", y = "National Diatbetes Death Rate") + 
  facet_wrap(~ Year) + 
  theme_minimal()


# Diabetes Death Rates and Access to Electricity
# Access to electricity is serving as a proxy for the level of technological advancement in a nation
# Potentially higher tech advancement associated with fewer labor jobs and less active work force overall in a nation. In addition one should also consider that a nations level of technological advancement may also be indicative of a more skillful and timely ability to treat disease in a nation. 
ggplot(data = df, aes(x = `Access to electricity (% of population)`, color = as.factor(IncomeLevel), y = Diabetes_Kidn_Deaths)) + 
  geom_point() + 
    layer(geom="line",
        stat="smooth",
        position="identity",
        params=list(method="auto", se=TRUE)) +
  labs(title = "Access to Electricity as a Proxy for National Level of Technological Advancement ", 
       subtitle = "Electricity Access (% of population)", 
       x= "Percent of Poputlation with Access to Electricity", y= "National Diabetes Death Rate") +
  facet_wrap(~ Year) +
  theme_minimal()


# Diabetes Death Rates and Parliamentary Gender Representation
# Interested to see if higher rates of practiced equity and gender parity, specifically, are associated with lower death rates from diabetes. 
ggplot(data = df, aes(x = `Proportion of seats held by women in national parliaments (%)`, color = as.factor(IncomeLevel), y = Diabetes_Kidn_Deaths)) + 
  geom_point() + 
    layer(geom="line",
        stat="smooth",
        position="identity",
        params=list(method="auto", se=TRUE)) +
  labs(title = "Gender Parity in Parliament Seats as a Proxy for National Equity and Inclusion", 
       subtitle = "Proportion of seats held by women in national parliaments (%)",
       x = "Proportion of seats held by women", y = "National Diabetes Death Rate") +
  facet_wrap(~ Year) +
  theme_minimal()


# Diabetes Death Rates and Gov't Health Expenditure
# In examining a scatter plot for domestic gov't health exp against diabetes caused deaths, skewness is apparent towards right side of the graph, so a log transformation is introduced.
ggplot(data = df, aes(x = `Domestic general government health expenditure per capita (current US$)`, color = as.factor(IncomeLevel), y = Diabetes_Kidn_Deaths)) + 
    geom_point() + 
  labs(title = "Gov't Health Expenditure per capita and Diabetes Death Rates", 
       subtitle= "add here",
       x = "Domestic general government health expenditure per capita (current US$)", y= "National Diabetes Death Rate") +
  layer(geom="line",
        stat="smooth",
        position="identity",
        params=list(method="auto", se=TRUE)) +
  facet_wrap(~ Year)


# Log(govt health exp) 
ggplot(data = df, aes(x = log(`Domestic general government health expenditure per capita (current US$)`), color = as.factor(IncomeLevel), y = Diabetes_Kidn_Deaths)) + 
  labs(title = "Gov't Health Expenditure per capita and Diabetes Death Rates (log)", 
       subtitle = "add here",
       x = "Domestic general government health expenditure per capita (current US$)", y = "Diabetes Death Rate") +
  geom_point() + 
  layer(geom="line",
        stat="smooth",
        position="identity",
        params=list(method="auto", se=TRUE)) +
  facet_wrap(~ Year)


# Diabetes Death Rates and Private Health Expenditure
# In examining a scatter plot for domestic private health exp against diabetes caused deaths, skewness is apparent towards right side of the graph, so a log transformation is introduced.
#
# Quick comparison of OOP vs Private health exp:
# Private Health Expenditure makes more sense as a variable to included with the domestic gov't health expenditure variable we are considering above. This is because the two taken together, would best represent total expenditure on health, where as the OOP expenditure leaves much left out, given its more restrictive nature. Ultimately, the OOP expenditure has a lower RMSE, its a very minute difference, but a difference still. That said, one can suppose that the OOP expenditure communicates a slight bit more in the model and better describes the differences perceived in diabetes death rates during the period.

ggplot(data = df, 
       mapping = aes(x = `Domestic private health expenditure per capita (current US$)`, color = as.factor(IncomeLevel), 
                     y = Diabetes_Kidn_Deaths)) + 
  labs(title = "Private Health Expenditure per capita and Diabetes Death Rates", 
       subtitle = "add _here ",
       x= "Domestic private health expenditure per capita (current US$)", y= "Diabetes Death Rate") +
  geom_point() + 
  layer(geom="line",
        stat="smooth",
        position="identity",
        params=list(method="auto", se=TRUE)) +
  facet_wrap(~ Year)

# Log(priv health exp)
ggplot(data = df, 
       mapping = aes(x = log(`Domestic private health expenditure per capita (current US$)`), color = as.factor(IncomeLevel), 
                     y = Diabetes_Kidn_Deaths)) + 
  labs(title = "Private Health Expenditure per capita and Diabetes Death Rates (log)", 
       subtitle = "add _here ",
       x= "`Domestic private health expenditure per capita (current US$)`", y= "Diabetes Death Rate") +
  geom_point()  + 
  layer(geom="line",
        stat="smooth",
        position="identity",
        params=list(method="auto", se=TRUE)) +
  facet_wrap(~ Year)

```


# Correlation Coefficients and RMSE for Single Linear Regression 2000
```{r correlation and rmse single regression values 2000 }

df_2000<- df %>%
  select(colnames(df))%>%
  filter(Year == "2000")

print("Correlation Coefficients:")
print(cor(df_2000$Diabetes_Kidn_Incid, df_2000$Diabetes_Kidn_Deaths))
print(cor(df_2000$`People using at least basic drinking water services (% of population)`, df_2000$Diabetes_Kidn_Deaths))
print(cor(df_2000$`Access to electricity (% of population)`, df_2000$Diabetes_Kidn_Deaths))
print(cor(df_2000$`Proportion of seats held by women in national parliaments (%)`, df_2000$Diabetes_Kidn_Deaths))
print(cor(df_2000$`Domestic general government health expenditure per capita (current US$)`, df_2000$Diabetes_Kidn_Deaths))
print(cor(df_2000$`Domestic private health expenditure per capita (current US$)`, df_2000$Diabetes_Kidn_Deaths))

print("RMSE for Single Linear Regressions:")
rmse(lm(df_2000$Diabetes_Kidn_Deaths ~ df_2000$Diabetes_Kidn_Incid))
rmse(lm(df_2000$Diabetes_Kidn_Deaths ~ df_2000$`People using at least basic drinking water services (% of population)`))
rmse(lm(df_2000$Diabetes_Kidn_Deaths ~ df_2000$`Access to electricity (% of population)`))
rmse(lm(df_2000$Diabetes_Kidn_Deaths ~ df_2000$`Proportion of seats held by women in national parliaments (%)`))
rmse(lm(df_2000$Diabetes_Kidn_Deaths ~ df_2000$`Domestic general government health expenditure per capita (current US$)`))
rmse(lm(df_2000$Diabetes_Kidn_Deaths ~ df_2000$`Domestic private health expenditure per capita (current US$)`))

```

# Multivariable Regression Model 2000 
```{r multilinear regression analysis 2000}

print("RMSE for Each Multivariable Model:")

rmse(lm(df_2000$Diabetes_Kidn_Deaths ~ df_2000$Diabetes_Kidn_Incid))

rmse(lm(df_2000$Diabetes_Kidn_Deaths ~ df_2000$Diabetes_Kidn_Incid + df_2000$`People using at least basic drinking water services (% of population)`))

rmse(lm(df_2000$Diabetes_Kidn_Deaths ~ df_2000$Diabetes_Kidn_Incid + df_2000$`People using at least basic drinking water services (% of population)` + df_2000$`Access to electricity (% of population)`))

rmse(lm(df_2000$Diabetes_Kidn_Deaths ~ df_2000$Diabetes_Kidn_Incid + df_2000$`People using at least basic drinking water services (% of population)` + df_2000$`Access to electricity (% of population)` + df_2000$`Proportion of seats held by women in national parliaments (%)`))

rmse(lm(df_2000$Diabetes_Kidn_Deaths ~ df_2000$Diabetes_Kidn_Incid + df_2000$`People using at least basic drinking water services (% of population)` + df_2000$`Access to electricity (% of population)` + df_2000$`Proportion of seats held by women in national parliaments (%)` + df_2000$`Domestic private health expenditure per capita (current US$)`))

rmse(lm(df_2000$Diabetes_Kidn_Deaths ~ df_2000$Diabetes_Kidn_Incid + df_2000$`People using at least basic drinking water services (% of population)` + df_2000$`Access to electricity (% of population)` + df_2000$`Proportion of seats held by women in national parliaments (%)` + df_2000$`Domestic private health expenditure per capita (current US$)` + df_2000$`Domestic general government health expenditure per capita (current US$)`))


summary(lm(df_2000$Diabetes_Kidn_Deaths ~ df_2000$Diabetes_Kidn_Incid + df_2000$`People using at least basic drinking water services (% of population)` + df_2000$`Access to electricity (% of population)` + df_2000$`Proportion of seats held by women in national parliaments (%)` + df_2000$`Domestic private health expenditure per capita (current US$)` + df_2000$`Domestic general government health expenditure per capita (current US$)`))

```






# Correlation Coefficients and RMSE for Single Linear Regression 2015
```{r correlation and rmse single regression values 2015 }

df_2015<- df %>%
  select(colnames(df))%>%
  filter(Year == "2015")

print("Correlation Coefficients:")
print(cor(df_2015$Diabetes_Kidn_Incid, df_2015$Diabetes_Kidn_Deaths))
print(cor(df_2015$`People using at least basic drinking water services (% of population)`, df_2015$Diabetes_Kidn_Deaths))
print(cor(df_2015$`Access to electricity (% of population)`, df_2015$Diabetes_Kidn_Deaths))
print(cor(df_2015$`Proportion of seats held by women in national parliaments (%)`, df_2015$Diabetes_Kidn_Deaths))
print(cor(df_2015$`Domestic general government health expenditure per capita (current US$)`, df_2015$Diabetes_Kidn_Deaths))
print(cor(df_2015$`Domestic private health expenditure per capita (current US$)`, df_2015$Diabetes_Kidn_Deaths))

print("RMSE for Single Linear Regressions:")
ModelMetrics::rmse(lm(df_2015$Diabetes_Kidn_Deaths ~ df_2015$Diabetes_Kidn_Incid))
ModelMetrics::rmse(lm(df_2015$Diabetes_Kidn_Deaths ~ df_2015$IncomeLevel))
ModelMetrics::rmse(lm(df_2015$Diabetes_Kidn_Deaths ~ df_2015$`People using at least basic drinking water services (% of population)`))
ModelMetrics::rmse(lm(df_2015$Diabetes_Kidn_Deaths ~ df_2015$`Access to electricity (% of population)`))
ModelMetrics::rmse(lm(df_2015$Diabetes_Kidn_Deaths ~ df_2015$`Proportion of seats held by women in national parliaments (%)`))
ModelMetrics::rmse(lm(df_2015$Diabetes_Kidn_Deaths ~ df_2015$`Domestic general government health expenditure per capita (current US$)`))
ModelMetrics::rmse(lm(df_2015$Diabetes_Kidn_Deaths ~ df_2015$`Domestic private health expenditure per capita (current US$)`))

summary(lm(df_2015$Diabetes_Kidn_Deaths ~ df_2015$Diabetes_Kidn_Incid))
summary(lm(df_2015$Diabetes_Kidn_Deaths ~ df_2015$IncomeLevel))
summary(lm(df_2015$Diabetes_Kidn_Deaths ~ df_2015$`People using at least basic drinking water services (% of population)`))
summary(lm(df_2015$Diabetes_Kidn_Deaths ~ df_2015$`Access to electricity (% of population)`))
summary(lm(df_2015$Diabetes_Kidn_Deaths ~ df_2015$`Proportion of seats held by women in national parliaments (%)`))
summary(lm(df_2015$Diabetes_Kidn_Deaths ~ df_2015$`Domestic general government health expenditure per capita (current US$)`))
summary(lm(df_2015$Diabetes_Kidn_Deaths ~ df_2015$`Domestic private health expenditure per capita (current US$)`))

```

# Multivariable Regression Model 2015
```{r multilinear regression analysis 2015}

df_2015$log_Parl_Parity <- log(df_2015$`Proportion of seats held by women in national parliaments (%)`)
df_2015$log_Govt_Exp <- log(df_2015$`Domestic general government health expenditure per capita (current US$)`)

print("RMSE for Each Multivariable Model:")

ModelMetrics::rmse(lm(df_2015$Diabetes_Kidn_Deaths ~ df_2015$Diabetes_Kidn_Incid))
summary((lm(df_2015$Diabetes_Kidn_Deaths ~ df_2015$Diabetes_Kidn_Incid)))

ModelMetrics::rmse(lm(df_2015$Diabetes_Kidn_Deaths ~ df_2015$Diabetes_Kidn_Incid + df_2015$IncomeLevel))
summary(lm(df_2015$Diabetes_Kidn_Deaths ~ df_2015$Diabetes_Kidn_Incid + df_2015$IncomeLevel))

ModelMetrics::rmse(lm(df_2015$Diabetes_Kidn_Deaths ~ df_2015$Diabetes_Kidn_Incid + df_2015$IncomeLevel + df_2015$`Access to electricity (% of population)`))
summary(lm(df_2015$Diabetes_Kidn_Deaths ~ df_2015$Diabetes_Kidn_Incid + df_2015$IncomeLevel + df_2015$`Access to electricity (% of population)`))

ModelMetrics::rmse(lm(df_2015$Diabetes_Kidn_Deaths ~ df_2015$Diabetes_Kidn_Incid + df_2015$IncomeLevel + df_2015$`People using at least basic drinking water services (% of population)`))
summary(lm(df_2015$Diabetes_Kidn_Deaths ~ df_2015$Diabetes_Kidn_Incid + df_2015$IncomeLevel + df_2015$`People using at least basic drinking water services (% of population)`))

ModelMetrics::rmse(lm(df_2015$Diabetes_Kidn_Deaths ~ df_2015$Diabetes_Kidn_Incid + df_2015$IncomeLevel + df_2015$`Proportion of seats held by women in national parliaments (%)`))
summary(lm(df_2015$Diabetes_Kidn_Deaths ~ df_2015$Diabetes_Kidn_Incid + df_2015$IncomeLevel + df_2015$`Proportion of seats held by women in national parliaments (%)`))
AIC(lm(df_2015$Diabetes_Kidn_Deaths ~ df_2015$Diabetes_Kidn_Incid + df_2015$IncomeLevel + df_2015$`Proportion of seats held by women in national parliaments (%)`))
plot(lm(df_2015$Diabetes_Kidn_Deaths ~ df_2015$Diabetes_Kidn_Incid + df_2015$IncomeLevel + df_2015$`Proportion of seats held by women in national parliaments (%)`))

ModelMetrics::rmse(lm(df_2015$Diabetes_Kidn_Deaths ~ df_2015$Diabetes_Kidn_Incid + df_2015$IncomeLevel  + df_2015$`Domestic general government health expenditure per capita (current US$)`))
summary(lm(df_2015$Diabetes_Kidn_Deaths ~ df_2015$Diabetes_Kidn_Incid + df_2015$IncomeLevel  + df_2015$`Domestic general government health expenditure per capita (current US$)`))
AIC(lm(df_2015$Diabetes_Kidn_Deaths ~ df_2015$Diabetes_Kidn_Incid + df_2015$IncomeLevel  + df_2015$`Domestic general government health expenditure per capita (current US$)`))
plot(lm(df_2015$Diabetes_Kidn_Deaths ~ df_2015$Diabetes_Kidn_Incid + df_2015$IncomeLevel  + df_2015$`Domestic general government health expenditure per capita (current US$)`))

ModelMetrics::rmse(lm(df_2015$Diabetes_Kidn_Deaths ~ df_2015$Diabetes_Kidn_Incid + df_2015$IncomeLevel  + df_2015$`Domestic general government health expenditure per capita (current US$)` + df_2015$`Domestic private health expenditure per capita (current US$)`))
summary(lm(df_2015$Diabetes_Kidn_Deaths ~ df_2015$Diabetes_Kidn_Incid + df_2015$IncomeLevel  + df_2015$`Domestic general government health expenditure per capita (current US$)` + df_2015$`Domestic private health expenditure per capita (current US$)`))


```


# Predicting 2019 Values for Comparison
```{r predicting and modeling 2019 data}
 

# Incorporate for each model built from 2015 to test

reg_2015 <- lm(df_2015$Diabetes_Kidn_Deaths ~ df_2015$Diabetes_Kidn_Incid + df_2015$IncomeLevel + df_2015$`Proportion of seats held by women in national parliaments (%)`)

predictions <- predict(reg_2015, df_2019)

error_info = data.frame(
  actual = df_2019$Data,
  prediction = predictions
)

RMSE <- Metrics::rmse(predictions, df_2019$Data)
cat("RMSE:", RMSE, "\n")



```

